# `cloud-sql-instance`
## Initial Setup
1. Configure the following Secret Manager secrets in the project the component is being deployed to
    * `{instance_key}_db_user`
    * `{instance_key}_db_password`
    * `{instance_key}_cloudsql_instance_id` for example: `recidiviz-staging:us-east1:dev-case-triage-data`
    * `{instance_key}_db_readonly_user` (optional)
    * `{instance_key}_db_readonly_password` (optional)
## Variables

| Name                         | Type                                                                                                                                                                                                                                              | Help                                                                                                                           |
|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------|
| `project_id`                 | <code>string</code>                                                                                                                                                                                                                               | The project for the related database instance                                                                                  |
| `create_bigquery_connection` | <code>bool</code>                                                                                                                                                                                                                                 | Set to true if you want to create BigQuery connections to the Cloud SQL instance                                               | 
| `instance_key`               | <code>string</code>                                                                                                                                                                                                                               | The string key for the database instance, e.g. "state" or "justice_counts".                                                    |
| `base_secret_name`           | <code>string</code>                                                                                                                                                                                                                               | The base name for our database-related secrets per `recidiviz.persistence.database.sqlalchemy_engine_manager`                  |
| `database_version`           | <code>string</code>                                                                                                                                                                                                                               | Postgres database version. See also https://cloud.google.com/sql/docs/postgres/create-instance#create-2nd-gen                  |
| `has_readonly_user`          | <code>bool</code>                                                                                                                                                                                                                                 | If true, a readonly user will be created from the configured `readonly` secrets                                                |
| `region`                     | <code>string</code>                                                                                                                                                                                                                               | Preferred region for the instance                                                                                              |
| `tier`                       | <code>string</code>                                                                                                                                                                                                                               | Preferred vCPU/Memory tier for the instance. See also https://cloud.google.com/sql/docs/postgres/create-instance#machine-types |
| `zone`                       | <code>string</code>                                                                                                                                                                                                                               | Preferred availability zone for the instance                                                                                   |
| `secondary_zone`             | <code>string</code>                                                                                                                                                                                                                               | Failover availability zone for the instance                                                                                    |
| `additional_databases`       | <code>list(string)</code>                                                                                                                                                                                                                         | Additional databases to create within the Postgres instance                                                                    |
| `insights_config`            | <pre>object({<br/> &Tab; query_insights_enabled  = optional(bool)<br /> &Tab; query_string_length     = optional(number)<br /> &Tab; record_application_tags = optional(bool)<br /> &Tab; record_client_address   = optional(bool)<br /> })</pre> | Configuration for GCP monitoring insights                                                                                      |

