<!doctype html>
<html>
  <head>
    <!--
	Most of this template's contents were generated by Auth0;
	for readability our additions should be denoted by comments below
	-->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Log In – Opportunities</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"
    />
    <!-- start custom code -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@500&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        margin: 0;
      }

      .page-wrapper {
        display: grid;
        grid-template-rows: auto auto;
        justify-content: center;
        align-content: center;
        min-height: 100vh;
        row-gap: 48px;
      }

      footer {
        max-width: 660px;
        padding: 0 16px;
        font-family: "Public Sans", sans-serif;
        font-weight: 500;
        letter-spacing: -0.01em;
        color: #2b5469d9;
        font-size: 14px;
        line-height: 1.5;
      }

      footer .help {
        color: #012322;
        font-size: 18px;
        line-height: 1.3;
      }

      /*
     * BELOW THIS LINE: 
     * overriding widget styles that can't be controlled via JS API
     */

      #widget-container .auth0-lock.auth0-lock {
        font-family: "Public Sans", sans-serif;
        font-weight: 500;
        letter-spacing: -0.01em;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-widget {
        width: 400px;
        max-width: 100vw;
      }

      /* prevents login pane from taking over screen height on small screens 
		 * and pushing out the footer */
      #widget-container
        .auth0-lock.auth0-lock
        .auth0-lock-cred-pane-internal-wrapper {
        height: auto;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-header-bg {
        background: none;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-header-bg-blur {
        display: none;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-header-bg-solid {
        display: none;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-name {
        font-size: 24px;
        line-height: 1.3;
        color: #003331;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-form p {
        font-size: 19px;
        line-height: 1.3;
        color: #003331;
        margin-bottom: 1em;
      }

      #widget-container .auth0-lock.auth0-lock .auth0-lock-input-wrap {
        border-color: #012322;
        border-radius: 3px;
      }

      #widget-container
        .auth0-lock.auth0-lock
        .auth0-lock-input-wrap.auth0-lock-focused {
        border-color: #3797cd;
      }

      #widget-container
        .auth0-lock.auth0-lock
        .auth0-lock-input-wrap.auth0-lock-input-wrap-with-icon {
        padding-left: inherit;
      }

      #widget-container
        .auth0-lock.auth0-lock
        .auth0-lock-input-wrap
        .auth0-lock-icon {
        display: none;
      }

      #widget-container
        .auth0-lock.auth0-lock
        .auth0-lock-input-wrap
        .auth0-lock-input {
        font-size: 16px;
        height: 48px;
        color: rgba(43, 84, 105, 0.85);
        border-radius: 3px;
      }
    </style>
    <!-- end custom code -->
  </head>
  <body>
    <!-- start custom code -->
    <div class="page-wrapper">
      <div id="widget-container"></div>
      <footer>
        <p class="help">
          Having trouble logging in? Talk to your case manager to make sure you
          have access to this website and to get your username and password.
        </p>
        <p>
          This website is made by Recidiviz, a non-profit organization that is
          partnered with the Maine Department of Corrections. The information in
          this website is based on information from the state of Maine, but it
          is not an official statement from Maine about you. This content of
          this website is not legal advice, and it does not give you any rights
          or make any promises about when you’ll be released.
        </p>
        <p>
          We tried to get this information right, but we could have made
          mistakes, and it may not cover everything. Laws and rules can change,
          and everyone’s situation is different. Talk to your case manager or
          lawyer before you decide to do anything based on the information on
          this website.
        </p>
      </footer>
    </div>

    <!-- end custom code -->
    <script src="https://cdn.auth0.com/js/lock/12.5/lock.min.js"></script>
    <script>
      // Decode utf8 characters properly
      var config = JSON.parse(
        decodeURIComponent(escape(window.atob("@@config@@"))),
      );
      config.extraParams = config.extraParams || {};
      var connection = config.connection;
      var prompt = config.prompt;
      var languageDictionary = {};
      var language;

      // start custom code
      languageDictionary.passwordInputPlaceholder = "Password";
      languageDictionary.usernameInputPlaceholder = "Username";

      /* Lock widget internals do not let us ignore injected values during string formatting;
       * in this case we do not want to display the domain for an enterprise Active Directory connection
       * because it is only used internally by AD and is not meaningful to users. To do this
       * we will format it in a standard and regex-detectible way, then detect it and delete it when it renders.
       * */

      // this should be used in the languageDictionary below as needed when customizing per connection
      const facilityCodeFormatString = "[facility code: %s]";
      // this should match the string defined above
      const facilityCodeRegex = /\[facility code: .+?\]/;
      function detectAndRemoveFacilityCodeText() {
        const widgetObserver = new MutationObserver((records, observer) => {
          records.forEach((record) => {
            const target = record.target.querySelector(".auth0-lock-form p");
            if (target) {
              target.innerHTML = target.innerHTML.replace(
                facilityCodeRegex,
                "",
              );

              observer.disconnect();
            }
          });
        });

        widgetObserver.observe(
          document.body.querySelector("#widget-container"),
          { childList: true, subtree: true },
        );
      }

      switch (connection) {
        // these values should match the values in the Opportunities landing page configs
        case "ME-Mountain-View-AD-Staging-Connection":
        case "ME-Mountain-View-AD-Connection":
          // unfortunately there is no way to make Lock ignore the %s parameter
          // that is passed to this string when rendering the widget.
          // The function called below should remove it before it is actually visible
          languageDictionary.enterpriseActiveLoginInstructions = `Enter the username and password you use to log in to Maine DOC computers. ${facilityCodeFormatString}`;
          languageDictionary.usernameInputPlaceholder =
            "Username (e.g., john.smith)";
          detectAndRemoveFacilityCodeText();
          break;
      }
      // end custom code

      if (config.dict && config.dict.signin && config.dict.signin.title) {
        languageDictionary.title = config.dict.signin.title;
      } else if (typeof config.dict === "string") {
        language = config.dict;
      }
      var loginHint = config.extraParams.login_hint;
      var colors = config.colors || {};

      // Available Lock configuration options: https://auth0.com/docs/libraries/lock/lock-configuration
      var lock = new Auth0Lock(config.clientID, config.auth0Domain, {
        auth: {
          redirectUrl: config.callbackURL,
          responseType:
            (config.internalOptions || {}).response_type ||
            (config.callbackOnLocationHash ? "token" : "code"),
          params: config.internalOptions,
        },
        configurationBaseUrl: config.clientConfigurationBaseUrl,
        overrides: {
          __tenant: config.auth0Tenant,
          __token_issuer: config.authorizationServer.issuer,
        },
        assetsUrl: config.assetsUrl,
        allowedConnections: connection ? [connection] : null,
        rememberLastLogin: !prompt,
        language: language,
        languageBaseUrl: config.languageBaseUrl,
        languageDictionary: languageDictionary,
        theme: {
          // start custom code
          logo: "https://opportunities.app/apple-touch-icon.png",
          // end custom code
          primaryColor: colors.primary ? colors.primary : "green",
        },
        prefill: loginHint ? { email: loginHint, username: loginHint } : null,
        closable: false,
        defaultADUsernameFromEmailPrefix: false,
        // start custom code
        container: "widget-container",
        // end custom code
      });

      if (colors.page_background) {
        var css = "body { background: " + colors.page_background + " }";
        var style = document.createElement("style");

        style.appendChild(document.createTextNode(css));

        document.body.appendChild(style);
      }

      lock.show();
    </script>
  </body>
</html>
